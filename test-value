.386
.model flat, stdcall
option casemap:none

.data
    kernel32Name    db "kernel32.dll", 0
    qpcName         db "QueryPerformanceCounter", 0
    exitName        db "ExitProcess", 0
    counter         dq 0             ; 64-bit LARGE_INTEGER

.code
start:
    ; Get handle to kernel32.dll
    push    offset kernel32Name
    call    getModuleHandleA

    ; Get address of QueryPerformanceCounter
    mov     ebx, eax                 ; save hModule
    push    offset qpcName
    push    ebx
    call    getProcAddress
    mov     esi, eax                 ; store QueryPerformanceCounter addr

    ; Call QueryPerformanceCounter(&counter)
    push    offset counter
    call    esi

    ; Get address of ExitProcess
    push    offset exitName
    push    ebx                      ; same kernel32.dll handle
    call    getProcAddress
    ; ExitProcess
